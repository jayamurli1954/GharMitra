<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>GharMitra - Housing Society Management</title>

  <!-- PWA Meta Tags -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1e3a8a">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="GharMitra">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <script>
    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('Service Worker registered', reg))
          .catch(err => console.log('Service Worker registration failed', err));
      });
    }

    // Track if React has successfully mounted
    window.__REACT_MOUNTED__ = false;

    // Capture critical errors only (before React mounts)
    window.addEventListener('error', function (e) {
      // Ignore errors after React has mounted (let React handle them)
      if (window.__REACT_MOUNTED__) {
        console.warn('Post-mount error (handled by React):', e.error || e.message);
        return;
      }

      // Ignore errors from browser extensions
      if (e.filename && (e.filename.includes('extension') || e.filename.includes('chext'))) {
        console.warn('Ignoring extension error:', e.message);
        return;
      }

      // Ignore undefined errors (usually from extensions)
      if (!e.error && !e.message) {
        console.warn('Ignoring undefined error');
        return;
      }

      console.error('Global error caught:', e.error);
      var root = document.getElementById('root');
      if (root) {
        var errorMsg = e.error ? e.error.toString() : e.message;
        var errorStack = e.error && e.error.stack ? e.error.stack : 'No stack trace available';
        root.innerHTML = '<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; padding: 20px; text-align: center; background: #fff;"><h1 style="color: #ff4444; margin-bottom: 20px;">⚠️ JavaScript Error</h1><p style="color: #666; font-size: 18px; margin-bottom: 10px;">React failed to load</p><div style="background: #f5f5f5; padding: 15px; border-radius: 8px; max-width: 800px; margin: 20px 0; text-align: left;"><p style="color: #333; font-size: 14px; margin-bottom: 10px; font-weight: bold;">Error Message:</p><p style="color: #ff4444; font-size: 12px; margin-bottom: 15px; word-break: break-all;">' + errorMsg + '</p><details style="margin-top: 10px;"><summary style="cursor: pointer; color: #007AFF; margin-bottom: 10px;">Show Full Error Details</summary><pre style="color: #666; font-size: 11px; text-align: left; overflow-x: auto; background: #fff; padding: 10px; border-radius: 4px; margin-top: 10px;">' + errorStack + '</pre></details></div><div style="margin-top: 20px;"><p style="color: #999; font-size: 12px; margin-bottom: 10px;">To open Developer Tools, try:</p><ul style="color: #666; font-size: 11px; text-align: left; list-style: none; padding: 0;"><li>• Right-click page → "Inspect" or "Inspect Element"</li><li>• Press Ctrl + Shift + I</li><li>• Press Ctrl + Shift + J (Chrome/Edge)</li><li>• Menu (3 dots) → More Tools → Developer Tools</li></ul></div><button onclick="window.location.reload()" style="margin-top: 20px; padding: 12px 24px; background: #007AFF; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold;">Reload Page</button></div>';
      }
    }, true);

    // Test if bundle.js loaded (only if React hasn't mounted after 5 seconds)
    window.addEventListener('load', function () {
      console.log('Page fully loaded');
      setTimeout(function () {
        // Use the __REACT_MOUNTED__ flag to check if React mounted
        if (window.__REACT_MOUNTED__) {
          console.log('React mounted successfully - app is running');
          return; // Everything is fine
        }

        console.error('React did not mount after 5 seconds');
        var root = document.getElementById('root');
        if (root) {
          var bundleTest = document.querySelector('script[src*="bundle.js"]');
          if (!bundleTest) {
            root.innerHTML = '<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; padding: 20px; text-align: center;"><h1 style="color: #ff4444;">⚠️ Bundle.js Not Found</h1><p style="color: #666; font-size: 18px; margin-bottom: 10px;">The JavaScript bundle is not loading</p><p style="color: #999; font-size: 14px; margin-bottom: 20px;">Check if dev server is running: npm run dev</p><button onclick="window.location.reload()" style="margin-top: 20px; padding: 12px 24px; background: #007AFF; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold;">Reload Page</button></div>';
          } else {
            root.innerHTML = '<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; padding: 20px; text-align: center;"><h1 style="color: #ff4444;">⚠️ React Failed to Mount</h1><p style="color: #666; font-size: 18px; margin-bottom: 10px;">Bundle.js loaded but React did not initialize</p><p style="color: #999; font-size: 14px; margin-bottom: 20px;">There may be a JavaScript error. Check the console for details.</p><button onclick="window.location.reload()" style="margin-top: 20px; padding: 12px 24px; background: #007AFF; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold;">Reload Page</button></div>';
          }
        }
      }, 5000);
    });

    // Test if basic JavaScript works
    console.log('HTML loaded, waiting for React...');
  </script>
</head>

<body style="background-color: #f5f5f5; margin: 0; padding: 0;">
  <div id="root">
    <div
      style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif;">
      <h1 style="color: #007AFF; margin-bottom: 20px;">GharMitra</h1>
      <p style="color: #666; font-size: 18px;">Application is initializing...</p>
      <p style="color: #999; font-size: 14px; margin-top: 40px;">If this message doesn't disappear, please check
        your internet connection or backend server.</p>
    </div>
  </div>
  <script type="module" src="/src/index.jsx"></script>
</body>

</html>
